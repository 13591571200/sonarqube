<% #locals = rule, active_rule, is_admin
  create_buttons_div_id = "cb_" + rule.id.to_s
  create_rule_note_button_div_id = "cnb_" + rule.id.to_s
  create_active_rule_note_button_div_id = "canb_" + rule.id.to_s
  create_rule_note_form_div_id = "crnf_" + rule.id.to_s
  create_active_rule_note_form_div_id = "carnf_" + rule.id.to_s
  submit_rule_note_id = "srn_" + rule.id.to_s
  submit_active_rule_note_id = "sarn_" + rule.id.to_s
  rule_note_text_id = "rnt_" + rule.id.to_s
  active_rule_note_text_id = "arnt_" + rule.id.to_s
%>

<div style="margin-top: 10px;">

<div id="<%= create_buttons_div_id -%>">
    <input type="button" id="<%= create_rule_note_button_div_id -%>" value="<%= message('rules_configuration.add_note') -%>" 
           onclick="$('<%= create_buttons_div_id -%>').hide();$('<%= create_rule_note_form_div_id -%>').show();$('<%= rule_note_text_id -%>').focus();"
           <%= 'style="display:none;"' if rule.note -%>>
    <input type="button" id="<%= create_active_rule_note_button_div_id -%>" value="<%= message('rules_configuration.add_activation_note') -%>"
           onclick="$('<%= create_buttons_div_id -%>').hide();$('<%= create_active_rule_note_form_div_id -%>').show();$('<%= active_rule_note_text_id -%>').focus();"
           <%= 'style="display:none;"' unless active_rule && !active_rule.note -%>>
</div>

<div id="<%= create_rule_note_form_div_id -%>" style="display: none" class="admin">
  <%= form_remote_tag :url => {:action => 'update_note', :rule_id => rule.id, :is_active_rule => false},
                      :update => "rule_note_#{rule.id}",
                      :complete => "$('#{create_rule_note_form_div_id}').hide();$('#{create_buttons_div_id}').show();$('#{create_rule_note_button_div_id}').hide();" %>
    <textarea name="text" id="<%= rule_note_text_id -%>" cols="100" rows="10" onkeyup="if (this.value=='') $('<%= submit_rule_note_id -%>').disabled=true; else $('<%= submit_rule_note_id -%>').disabled=false;"></textarea>
    <div class="note" style="padding: 5px 0px"><%= message('rules_configuration.adding_note_description') -%></div>
    <input type="submit" value="<%= message('rules_configuration.create_note') -%>" name="commit" id="<%= submit_rule_note_id -%>" disabled/>
    <a href="#" onclick="$('<%= create_buttons_div_id -%>').show();$('<%= create_rule_note_form_div_id -%>').hide();return false;"><%= message('cancel') %></a>
  </form>
</div>

<% if active_rule %>
<div id="<%= create_active_rule_note_form_div_id -%>" style="display: none" class="admin">
  <%= form_remote_tag :url => {:action => 'update_note', :rule_id => active_rule.id, :is_active_rule => true},
                      :update => "active_rule_note_#{active_rule.id}",
                      :complete => "$('#{create_active_rule_note_form_div_id}').hide();$('#{create_buttons_div_id}').show();$('#{create_active_rule_note_button_div_id}').hide();"  %>
    <textarea name="text" id="<%= active_rule_note_text_id -%>" cols="100" rows="10" onkeyup="if (this.value=='') $('<%= submit_active_rule_note_id -%>').disabled=true; else $('<%= submit_active_rule_note_id -%>').disabled=false;"></textarea>
    <div class="note" style="padding: 5px 0px"><%= message('rules_configuration.adding_activation_note_description')-%></div>
    <input type="submit" value="<%= message('rules_configuration.create_activation_note') -%>" name="commit" id="<%= submit_active_rule_note_id -%>" disabled/>
    <a href="#" onclick="$('<%= create_buttons_div_id -%>').show();$('<%= create_active_rule_note_form_div_id -%>').hide();return false;"><%= message('cancel') %></a>
  </form>
</div>
<% end %>

</div>