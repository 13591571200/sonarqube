<h1>My profile</h1>
<div class="admin">
<table class="form">
  <tr>
    <td><b>Login:</b></td>
    <td id="login"><%= current_user.login %></td>
  </tr>
  <tr>
    <td><b>Name:</b></td>
    <td id="name"><%= current_user.name %></td>
  </tr>
  <tr>
    <td><b>Email:</b></td>
    <td id="name"><%= current_user.email %></td>
  </tr>
  <tr>
    <td><b>Groups:</b></td>
    <td id="groups"><%= current_user.groups.sort.map(&:name).join(', ') %></td>
  </tr>
</table>
</div>

<% if User.editable_password? %>
<h1>Change password</h1>
<div class="admin">
  <% form_tag( {:action => 'change_password' }, :id => 'pass_form_tag', :name => 'pass_form_tag') do -%>
  <table class="form">
    <tr>
      <td class="keyCell"><label for="old_password"><b>Old value:</b></label></td>
      <td><%= password_field_tag 'old_password' %></td>
    </tr>
    <tr>
      <td class="keyCell"><label for="password"><b>New value:</b></label></td>
      <td><%= password_field_tag 'password' %></td>
    </tr>
    <tr>
      <td class="keyCell"><label for="password_confirmation"><b>Confirm new value:</b></label></td>
      <td><%= password_field_tag 'password_confirmation' %></td>
    </tr>
    <tr>
      <td></td>
      <td><%= submit_tag 'Change password' %></td>
    </tr>
  </table>
  <% end %>

  <script type="text/javascript">
  //<![CDATA[
    $('pass_form_tag').focusFirstElement();
  //]]>
  </script>
</div>
<% end -%>

<h1>Notifications</h1>
<div class="admin">
<% form_tag({:action => 'update_notifications'}, {:method => 'post'}) do %>
  <table class="form">
    <tr>
      <td></td>
      <% for channel in @channels %>
      <td><b><%= message('notification.channel.' + channel.getKey()) -%></b></td>
      <% end %>
    </tr>
    <% for dispatcher in @dispatchers %>
    <tr>
      <td><b><%= message('notification.dispatcher.' + dispatcher.getKey()) -%></b></td>
      <td>
        <%
        for channel in @channels
          notification_id = dispatcher.getKey() + '.' + channel.getKey()
          check_box_id = 'notifications[' + notification_id + ']'
          check_box_checked = @notifications[notification_id]
        %>
          <%= check_box_tag check_box_id, 'true', check_box_checked %>
        <% end %>
      </td>
    </tr>
    <% end %>
    <tr>
      <td></td>
      <td><%= submit_tag %></td>
    </tr>
  </table>
<% end %>
</div>
