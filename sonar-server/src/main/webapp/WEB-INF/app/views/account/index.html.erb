<h1>My profile</h1>
<br/>

<table>
  <tr>
    <td><b>Login:</b></td>
    <td class="sep"> </td>
    <td id="login"><%= current_user.login %></td>
  </tr>
  <tr>
    <td><b>Name:</b></td>
    <td class="sep"> </td>
    <td id="name"><%= current_user.name %></td>
  </tr>
  <tr>
    <td><b>Groups:</b></td>
    <td class="sep"> </td>
    <td id="groups"><%= current_user.groups.sort.map(&:name).join(', ') %></td>
  </tr>
</table>
<br/>

<% if User.editable_password? %>
<h1>Change password</h1>
<br/>
  <% form_tag( {:action => 'change_password' }, :id => 'pass_form_tag', :name => 'pass_form_tag') do -%>
	<table>
		<tr>
			<td nowrap>
        <label for="old_password"><b>Old value:</b></label>
      </td>
      <td class="sep"> </td>
      <td align="left">
        <%= password_field_tag 'old_password' %>
      </td>
    </tr>
    <tr>
	    <td nowrap>
        <label for="password"><b>New value:</b></label>
      </td>
      <td class="sep"> </td>
      <td align="left">
        <%= password_field_tag 'password' %>
      </td>
     </tr>
     <tr>
		 	<td nowrap>
         <label for="password_confirmation"><b>Confirm new value:</b></label>
      </td>
      <td class="sep"> </td>
      <td align="left">
                <%= password_field_tag 'password_confirmation' %>
            </td>
      </tr>

	</table>
	<br/>
	<%= submit_tag 'Change password' %>
  <% end %>
	<script type="text/javascript">
	//<![CDATA[
    $('pass_form_tag').focusFirstElement();
  //]]>
	</script>
<% end -%>
<br/>

<h1>Notifications</h1>
<br/>
<% form_tag({:action => 'update_notifications'}, {:method => 'post'}) do %>
  <table>
    <tr>
      <td></td>
      <% for channel in @channels %>
      <td><%= channel.getKey() %></td>
      <% end %>
    </tr>
    <% for dispatcher in @dispatchers %>
    <tr>
      <td><%= dispatcher.getKey() %></td>
      <td>
        <%
        for channel in @channels
          notification_id = dispatcher.getKey() + '.' + channel.getKey()
          check_box_id = 'notifications[' + notification_id + ']'
          check_box_checked = @notifications[notification_id]
        %>
          <%= check_box_tag check_box_id, 'true', check_box_checked %>
        <% end %>
      </td>
    </tr>
    <% end %>
  </table>
  <br/>
  <%= submit_tag %>
<% end %>
<br/>
