<div>
  <div class="page-split-left">
    <%= render :partial => 'measures/sidebar' -%>
  </div>

  <% if @filter %>
    <div class="page-split-right">
      <div id="content">
        <div class="line-block marginbottom10">
          <ul class="operations">

            <%
               if @filter.display
                edit_mode = (params[:edit]=='true')
                unless edit_mode
            %>
              <li>
                <a id="change-display" href="<%= url_for params.merge({:edit => true, :id => @filter.id}) -%>"><%= message("measure_filter.#{@filter.display.key}.change") -%></a>
              </li>
            <% end %>
            <li>
              <%= message 'measure_filter.display_as' -%>:
              <% MeasureFilterDisplay.keys.each do |display_key| %>
                <%= link_to_if display_key!=@filter.display.key, message("measure_filter.display.#{display_key}"), params.merge(:action => 'search', :display => display_key, :id => @filter.id), :id => "display_as_#{display_key}" -%>
              <% end %>
            </li>
            <% end %>

            <% if logged_in? %>
              <% if @filter.id %>
                <li><a id="copy" href="<%= url_for params.merge({:action => 'copy_form', :id => @filter.id}) -%>" class="link-action open-modal"><%= message('copy') -%></a></li>
              <% end %>
              <% if @filter.owner?(current_user) %>
                <li><a id="save" href="<%= url_for params.merge({:action => 'save_form', :id => @filter.id}) -%>" class="link-action open-modal"><%= message('save') -%></a></li>
              <% end %>
            <% end %>
          </ul>
          <div class="page_title" id="filter-title">
            <% if @filter.name.present? %>
              <span class="h3"><%= h @filter.name -%></span>
              <span class="note">
                <% if !@filter.shared %>
                  [<%= message 'measure_filter.private' -%>]
                <% elsif logged_in? && @filter.user_id==current_user.id %>
                  [<%= message 'measure_filter.shared_with_all_users' -%>]
                <% elsif @filter.user_id %>
                  [<%= message 'shared_by' -%> <%= @filter.user.name -%>]
                <% else %>
                  [<%= message 'shared_by' -%> Sonar]
                <% end %>
              </span>
              <% if @filter.description.present? %>
                - <span class="note"><%= h @filter.description -%></span>
              <% end %>
            <% end %>
          </div>
        </div>

        <%= render :partial => 'measures/display', :locals => {:filter => @filter, :edit_mode => edit_mode, :widget_id => nil} -%>
      </div>
    </div>
  <% end %>
</div>