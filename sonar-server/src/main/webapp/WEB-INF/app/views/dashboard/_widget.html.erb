<%
   @backup_resource=@resource
   @backup_project=@project
   @backup_snapshot=@snapshot
   @backup_dashboard_configuration=@dashboard_configuration

   if widget.property_value('project')
     @project = @resource = Project.find(widget.property_value('project'))
     @snapshot=@resource.last_snapshot
     @dashboard_configuration=Api::DashboardConfiguration.new(@dashboard, :period_index => params[:period], :snapshot => @snapshot)
   end
%>

<div class="<%= h widget.key -%>" style="height:100%;">
  <% if widget.configured
       begin
         widget_body=render :inline => widget.java_definition.getTarget().getTemplate(), :locals => {:widget_properties => widget.properties_as_hash, :widget => widget, :dashboard_configuration => @dashboard_configuration}
       rescue => error
         logger.error(message('dashboard.cannot_render_widget_x', :params => [widget.key, error]))
         logger.error(error.backtrace.join("\n"))
         widget_body=""
       end

       if widget_body.include?('<')
         default_layout=(widget.java_definition.getWidgetLayout().name()=='DEFAULT')
         if default_layout
      %>
        <div class="widget">
      <% end %>
      <%= widget_body -%>
      <% if default_layout %>
        <div class="clear"></div>
        </div>
      <% end %>
    <% end %>
  <% else %>
    <div class="widget">
      <p>
        <a href="<%= url_for(dashboard_action(:configure, :id => @dashboard.id)) -%>"><%= message('dashboard.please_configure_the_widget_x', :params => widget.java_definition.getTitle()) -%></a>
      </p>
    </div>
  <% end %>
  <div style="clear: both;"></div>
</div>

<%
   @resource=@backup_resource
   @project=@backup_project
   @snapshot=@backup_snapshot
   @dashboard_configuration=@backup_dashboard_configuration
%>
