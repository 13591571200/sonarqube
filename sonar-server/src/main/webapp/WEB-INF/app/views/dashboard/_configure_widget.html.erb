<%
  begin
    widget_body=render :inline => definition.getTarget().getTemplate(), :locals => {:widget_properties => widget.properties_as_hash}
  rescue => error
     logger.error("Can not render widget #{definition.getId()}: " + error)
     logger.error(error.backtrace.join("\n"))
     widget_body=""
  end
%>

<div class="handle" style="//overflow:hidden;//zoom:1;">
  <%= definition.getTitle() -%>
  <a class="block-remove"  onclick="remove_widget(this);return false;">Delete</a>
  <a class="block-view-toggle" onclick="return toggle_block(this);">Edit</a> &nbsp;
</div>
<% if defined?(validation_result) %>
  <div class="error" style="<%= "display: none;" unless validation_result["errormsg"] %>clear:both;margin: 0;border-bottom:0;">
    <span class="errormsg"><%= validation_result["errormsg"] if validation_result["errormsg"] %></span> &nbsp;&nbsp;[<a href="#" onclick="hide_block_info($(this).up('.block'));return false;">hide</a>]
  </div>
  <div class="notice" style="<%= "display: none;" unless validation_result["infomsg"] %>clear:both;margin: 0;border-bottom:0;">
    <span class="infomsg"><%= validation_result["infomsg"] if validation_result["infomsg"] %></span> &nbsp;&nbsp;[<a href="#" onclick="hide_block_info($(this).up('.block'));return false;">hide</a>]
  </div>
<% end %>

<div id="widget_<%= definition.getId().tr('_', '') -%>" class="content <%= definition.getId() -%>" style="height:100%;">
  <!--[if lte IE 6]>
  <style type="text/css">
    #dashboard .block .content .transparent {
        display: none;
    }
  </style>
  <![endif]-->
<div class="transparent"></div>
  <% if widget_body.include? '<' %>
  <%= widget_body %>
  <% else %>
  <div class="widget"><p>No data</p></div>
  <% end %>
<div style="clear: both;"></div>
</div>

