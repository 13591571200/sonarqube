<%
   def treemap_metrics(filter)
     metrics=filter.measure_columns.map{|col| col.metric}
     size_metric=(metrics.size>=1 ? metrics[0] : Metric.by_key('ncloc'))
     color_metric=nil
     if metrics.size>=2
       color_metric=metrics[1]
     end
     if color_metric.nil? || !color_metric.treemap_color?
       color_metric=Metric.by_key('violations_density')
     end
     [size_metric, color_metric]
   end
%>

<% if @filter.period? %>
  <%= message('filters.treemap_not_supported_for_period_selection') -%>

<% else %>
  <%
     metrics=treemap_metrics(@filter)
  %>
  <%= render :partial => 'treemap/treemap_container', :locals => {
    :treemap_id => @filter.id,
    :size_metric => metrics[0],
    :color_metric => metrics[1],
    :height_in_percents => 50.0,
    :context_type => 'filter',
    :context_id => @filter.id
  } -%>
<% end %>
