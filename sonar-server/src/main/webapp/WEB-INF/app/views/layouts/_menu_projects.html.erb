<script>
  if (supports_html5_storage()) {
    var sonarRecentHistory = new Sonar.RecentHistory();
  }
</script>

<li>
  <a href="#" onclick="if (sonarRecentHistory) { sonarRecentHistory.populateRecentHistoryPanel(); }; $j('#projects-menu').toggle(); return false;" class="link-more"><%= message('layout.projects') -%></a>
  
  <div id="projects-menu" class="dropdown-menu" style="max-width: none; display: none;" onmouseout="$j(this).hide();" onmouseover="$j(this).show();">
    <div id="recent-history" style="border-bottom: 1px solid #ccc; padding-bottom: 10px;">
      <h2><%= message('layout.recent_activity') -%></h2>
      <ul id="recent-history-list">
      </ul>
    </div>
    
    <div>
      <ul>
        <% Project.root_qualifiers.sort.each do |qualifier| %>      
          <li><a href="<%= ApplicationController.root_context -%>/entities?qualifier=<%= qualifier -%>"><%= message('qualifiers.all.' + qualifier) -%></a></li>
        <% end %>
      </ul>
    </div>
  </div>
  
</li>

<script>
  if (sonarRecentHistory == null) {
    $j('#recent-history').detach();
  } else {
    sonarRecentHistory.add('<%= @resource ? @resource.key : "" -%>', 
                           '<%= @resource ? @resource.name : "" -%>', 
                           '<%= @resource ? Api::Utils.java_facade.getResourceType(@resource.qualifier).getIconPath() : "" -%>');
  }
</script>