<% is_admin=is_admin? %>
<table width="100%">
  <tr>
    <td valign="top">

      <h1 class="marginbottom10">My dashboards</h1>
      <table class="data marginbottom10" id="dashboards">
        <thead>
          <tr>
            <th>Name</th>
            <% if is_admin %><th>Shared</th><% end %>
            <th>Order</th>
            <th>Operations</th>
          </tr>
        </thead>
        <tbody>
        <% if @actives.nil? || @actives.empty? %>
        <tr class="even"><td colspan="5">No dashboards</td></tr>
        <%
          else
            @actives.each_with_index do |active,index| %>
            <tr id="dashboard-<%= u active.name -%>" class="<%= cycle('even','odd', :name => 'dashboards') -%>">
              <td>
                <%= link_to active.name, {:controller => :dashboard, :action => :index, :id => active.dashboard_id, :resource => params[:resource]} -%>
                <% if active.dashboard.description.present? %>
                <p class="small"><%= h active.dashboard.description -%></p>
                <% end %>
              </td>
              <% if is_admin %>
              <td>
                <%= boolean_icon(active.dashboard.shared, {:display_false => false}) -%>
              </td>
              <% end %>
              <td>
                <% if index>0 %>
                  <%= link_to image_tag('blue-up.png'), {:action => 'up', :id => active.dashboard_id, :resource => params[:resource]}, :method => :post, :id => "up-#{u active.name}" %>
                <% else %>
                  <%= image_tag('transparent_16.gif') %>
                <% end %>
                <% if index<@actives.size-1 %>
                  <%= link_to image_tag('blue-down.png'), {:action => 'down', :id => active.dashboard.id, :resource => params[:resource]}, :method => :post, :id => "down-#{u active.name}" %>
                <% end %>
              </td>
              <td>
                <% if active.owner?(current_user) %>
                  <%= link_to 'Configure widgets', {:controller => :dashboard, :action => 'configure', :id => active.dashboard_id, :resource => params[:resource]}, :id => "configure-#{u active.name}" %>
                  |
                  <%= link_to_remote "Edit", :update => "admin_form", :url => { :action => "edit", :id => active.dashboard_id, :resource => params[:resource] }, :id => "edit-#{u active.name}", :method => :get %>
                  |
                  <%= link_to 'Delete', {:action => 'delete', :id => active.dashboard_id, :resource => params[:resource]}, :method => :post, :confirm => 'Do you want to delete this dashboard ?', :id => "delete-#{u active.name}" %>
                <% else %>
                  <%= link_to 'Unfollow', {:action => 'unfollow', :id => active.dashboard_id, :resource => params[:resource]}, :method => :post, :id => "unfollow-#{u active.name}" %>
                <% end %>
              </td>
            </tr>
        <%  end
          end
        %>
        </tbody>
      </table>
      <br/><br/>
      <h1 class="marginbottom10">Shared dashboards</h1>
      <table class="data" id="shared-dashboards">
        <thead>
          <tr>
            <th>Name</th>
            <th>Shared by</th>
            <th>Operations</th>
          </tr>
        </thead>
        <tbody>
        <% if @shared_dashboards.nil? || @shared_dashboards.empty? %>
        <tr class="even"><td colspan="5">No dashboards</td></tr>
        <%
          else
            @shared_dashboards.each do |dashboard| %>
            <tr id="shared-dashboard-<%= u dashboard.name -%>" class="<%= cycle('even','odd', :name => 'shared') -%>">
              <td>
                <%= link_to dashboard.name, {:controller => :dashboard, :action => :index, :id => dashboard.id, :resource => params[:resource]} -%>
                <% if dashboard.description.present? %>
                <p class="small"><%= h dashboard.description -%></p>
                <% end %>
              </td>
              <td>
                <%= dashboard.user_name -%>
              </td>
              <td>
                <%= link_to 'Follow', {:action => 'follow', :id => dashboard.id, :resource => params[:resource]}, :method => :post, :id => "follow-#{u dashboard.name}" %>
              </td>
            </tr>
        <%  end
          end
        %>
        </tbody>
      </table>
    </td>
    <td class="sep"> </td>
    <td width="210" valign="top" align="right">
      <div id="admin_form">
      <%= render :partial => 'dashboards/create' %>
      </div>
    </td>
  </tr>
</table>
