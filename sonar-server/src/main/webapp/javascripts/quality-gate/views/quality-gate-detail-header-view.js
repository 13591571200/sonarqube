// Generated by CoffeeScript 1.6.3
(function() {
  var __hasProp = {}.hasOwnProperty,
    __extends = function(child, parent) { for (var key in parent) { if (__hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; };

  define(['backbone.marionette', 'handlebars'], function(Marionette, Handlebars) {
    var QualityGateDetailHeaderView, _ref;
    return QualityGateDetailHeaderView = (function(_super) {
      __extends(QualityGateDetailHeaderView, _super);

      function QualityGateDetailHeaderView() {
        _ref = QualityGateDetailHeaderView.__super__.constructor.apply(this, arguments);
        return _ref;
      }

      QualityGateDetailHeaderView.prototype.template = Handlebars.compile(jQuery('#quality-gate-detail-header-template').html());

      QualityGateDetailHeaderView.prototype.spinner = '<i class="spinner"></i>';

      QualityGateDetailHeaderView.prototype.modelEvents = {
        'change': 'render'
      };

      QualityGateDetailHeaderView.prototype.events = {
        'click #quality-gate-rename': 'renameQualityGate',
        'click #quality-gate-delete': 'deleteQualityGate',
        'click #quality-gate-set-as-default': 'setAsDefault',
        'click #quality-gate-unset-as-default': 'unsetAsDefault'
      };

      QualityGateDetailHeaderView.prototype.renameQualityGate = function() {
        this.options.app.qualityGateEditView.model = this.model;
        return this.options.app.qualityGateEditView.show();
      };

      QualityGateDetailHeaderView.prototype.deleteQualityGate = function() {
        var _this = this;
        if (confirm(window.SS.phrases.areYouSure)) {
          this.showSpinner();
          return jQuery.ajax({
            type: 'POST',
            url: "" + baseUrl + "/api/qualitygates/destroy",
            data: {
              id: this.model.id
            }
          }).always(function() {
            return _this.hideSpinner();
          }).done(function() {
            return _this.options.app.deleteQualityGate(_this.model.id);
          });
        }
      };

      QualityGateDetailHeaderView.prototype.changeDefault = function(set) {
        var data, method,
          _this = this;
        this.showSpinner();
        data = set ? {
          id: this.model.id
        } : {};
        method = set ? 'set_as_default' : 'unset_default';
        return jQuery.ajax({
          type: 'POST',
          url: "" + baseUrl + "/api/qualitygates/" + method,
          data: data
        }).always(function() {
          return _this.hideSpinner();
        }).done(function() {
          _this.options.app.unsetDefaults(_this.model.id);
          return _this.model.set('default', !_this.model.get('default'));
        });
      };

      QualityGateDetailHeaderView.prototype.setAsDefault = function() {
        return this.changeDefault(true);
      };

      QualityGateDetailHeaderView.prototype.unsetAsDefault = function() {
        return this.changeDefault(false);
      };

      QualityGateDetailHeaderView.prototype.showSpinner = function() {
        this.$el.hide();
        return jQuery(this.spinner).insertBefore(this.$el);
      };

      QualityGateDetailHeaderView.prototype.hideSpinner = function() {
        this.$el.prev().remove();
        return this.$el.show();
      };

      return QualityGateDetailHeaderView;

    })(Marionette.ItemView);
  });

}).call(this);
